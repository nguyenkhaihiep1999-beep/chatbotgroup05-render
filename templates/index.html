<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Chatbot Group 05 ‚Äî HUIT</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --blue:#2563eb;
  --bg:#f1f5f9;
}

html,body{
  height:100%;
  margin:0;
  font-family:Segoe UI,Roboto,Arial;
  background:var(--bg);
  display:flex;
  justify-content:center;
  align-items:center;
}

/* ===== CHAT BOX ===== */

.chat-shell{
  width:400px;
  height:640px;
  background:#fff;
  border-radius:24px;
  box-shadow:0 20px 50px rgba(0,0,0,.1);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* ===== HEADER ===== */

.chat-header{
  padding:25px 20px;
  text-align:center;
  border-bottom:1px solid #eee;
}

.main-logo{
  width:95px;
  margin-bottom:12px;
}

.chat-header h1{
  margin:0;
  font-size:26px;   /* CH·ª¶ ƒê·ªÄ TO */
  font-weight:700;
  color:var(--blue);
}

.chat-header p{
  margin:6px 0 0;
  font-size:14px;
  font-weight:600;   /* IN ƒê·∫¨M */
  color:#444;
}

/* ===== BODY ===== */

.chat-body{
  flex:1;
  padding:18px;
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.msg-row{display:flex}
.msg-row.bot{justify-content:flex-start}
.msg-row.user{justify-content:flex-end}

.bubble{
  max-width:75%;
  padding:11px 15px;
  border-radius:20px;
  font-size:14px;
  line-height:1.4;
}

.bot .bubble{
  background:#e2e8f0;
}

.user .bubble{
  background:var(--blue);
  color:#fff;
}

/* ===== FOOTER ===== */

.chat-footer{
  display:flex;
  padding:12px;
  gap:8px;
  align-items:center;
  border-top:1px solid #eee;
}

.chat-footer input{
  flex:1;
  padding:12px 15px;
  border-radius:25px;
  border:1px solid #ddd;
  outline:none;
}

/* ===== BUTTON ===== */

.btn{
  width:44px;
  height:44px;
  border-radius:50%;
  border:none;
  background:#e2e8f0;
  cursor:pointer;
  font-size:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:0.2s;
}

.btn:hover{
  background:#d1d5db;
}

.mic.recording{
  background:red;
  color:#fff;
  animation:pulse 1s infinite;
}

@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.15)}
  100%{transform:scale(1)}
}

/* ===== LOADING DOTS ===== */

.typing span{
  display:inline-block;
  animation:blink 1.4s infinite both;
}

.typing span:nth-child(2){animation-delay:.2s}
.typing span:nth-child(3){animation-delay:.4s}

@keyframes blink{
  0%{opacity:.2}
  20%{opacity:1}
  100%{opacity:.2}
}
</style>
</head>

<body>

<div class="chat-shell">

<div class="chat-header">
  <!-- ROBOT LOGO -->
  <img class="main-logo" 
       src="https://cdn-icons-png.flaticon.com/512/4712/4712027.png">
  <h1>Chatbot Group 05</h1>
  <p>T∆∞ v·∫•n tuy·ªÉn sinh ‚Äî HUIT</p>
</div>

<div class="chat-body" id="chatbox"></div>

<div class="chat-footer">
  <input id="message" placeholder="Nh·∫≠p c√¢u h·ªèi...">
  
  <button class="btn mic" id="micBtn">
    <i class="fa-solid fa-microphone"></i>
  </button>

  <button class="btn" id="sendBtn">
    <i class="fa-solid fa-paper-plane"></i>
  </button>
</div>

</div>

<script>
const chatbox=document.getElementById("chatbox");
const micBtn=document.getElementById("micBtn");

/* ===== ADD MESSAGE ===== */

function addBot(text){
  const div=document.createElement("div");
  div.className="msg-row bot";
  div.innerHTML=`<div class="bubble">${text}</div>`;
  chatbox.appendChild(div);
  chatbox.scrollTop=chatbox.scrollHeight;
}

function addUser(text){
  const div=document.createElement("div");
  div.className="msg-row user";
  div.innerHTML=`<div class="bubble">${text}</div>`;
  chatbox.appendChild(div);
  chatbox.scrollTop=chatbox.scrollHeight;
}

/* ===== WELCOME ===== */
window.onload=()=>{
  addBot("Xin ch√†o üëã M√¨nh c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?");
}

/* ===== SEND ===== */

async function sendMessage(text){
  if(!text) return;

  addUser(text);
  document.getElementById("message").value="";

  addBot(`<div class="typing">ƒêang t√¨m ki·∫øm <span>.</span><span>.</span><span>.</span></div>`);

  try{
    const res=await fetch("/chat",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:text})
    });
    const data=await res.json();
    chatbox.lastChild.remove();
    addBot(data.reply||"Ch∆∞a c√≥ d·ªØ li·ªáu.");
  }catch{
    chatbox.lastChild.remove();
    addBot("L·ªói k·∫øt n·ªëi server.");
  }
}

document.getElementById("sendBtn").onclick=()=>{
  sendMessage(document.getElementById("message").value.trim());
};

document.getElementById("message").addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    sendMessage(e.target.value.trim());
  }
});

/* ===== VOICE ===== */

if ('webkitSpeechRecognition' in window) {

  const recognition=new webkitSpeechRecognition();
  recognition.lang="vi-VN";

  micBtn.onclick=()=>{
    recognition.start();
    micBtn.classList.add("recording");
  };

  recognition.onresult=(e)=>{
    const text=e.results[0][0].transcript;
    micBtn.classList.remove("recording");
    sendMessage(text);
  };

  recognition.onend=()=>{
    micBtn.classList.remove("recording");
  };

}else{
  micBtn.onclick=()=>{
    addBot("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ voice. H√£y d√πng Chrome.");
  };
}
</script>

</body>
</html>