<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Chatbot Group 05</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #e8f1fb;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.chat-container {
    width: 420px;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
}

.chat-header {
    background: #0d6efd;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 20px;
    font-weight: bold;
    border-radius: 12px 12px 0 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.chat-header img {
    width: 32px;
    height: 32px;
}

#chatbox {
    padding: 15px;
    height: 300px;
    overflow-y: auto;
    background: #f4f8ff;
}

.message {
    max-width: 75%;
    padding: 10px 14px;
    border-radius: 15px;
    margin-bottom: 10px;
    clear: both;
    word-wrap: break-word;
}

.user {
    background: #0d6efd;
    color: white;
    float: right;
    border-bottom-right-radius: 4px;
}

.bot {
    background: #e2ebff;
    color: #000;
    float: left;
    border-bottom-left-radius: 4px;
}

.chat-input {
    display: flex;
    padding: 10px;
    border-top: 1px solid #ddd;
}

.chat-input input {
    flex: 1;
    padding: 10px;
    border-radius: 20px;
    border: 1px solid #ccc;
    outline: none;
}

.chat-input button {
    margin-left: 8px;
    padding: 8px 14px;
    border: none;
    border-radius: 50%;
    background: #0d6efd;
    color: white;
    cursor: pointer;
    font-size: 16px;
}

.chat-input button:hover {
    background: #084298;
}
</style>
</head>

<body>

<div class="chat-container">
    <div class="chat-header">
        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png" alt="robot">
        Chatbot Group 05
    </div>

    <div id="chatbox"></div>

    <div class="chat-input">
        <input type="text" id="message" placeholder="Nh·∫≠p c√¢u h·ªèi...">
        <button onclick="send()">‚û§</button>
        <button onclick="startVoice()">üé§</button>
    </div>
</div>

<script>
/* ===== L·ªúI CH√ÄO BAN ƒê·∫¶U ===== */
window.onload = () => {
    const box = document.getElementById("chatbox");
    box.innerHTML += `
        <div class="message bot">
            Xin ch√†o b·∫°n üëã<br>
            M√¨nh l√† <b>Chatbot Group 05</b> ü§ñ<br>
            M√¨nh c√≥ th·ªÉ h·ªó tr·ª£ th√¥ng tin v·ªÅ
            <b>Tr∆∞·ªùng ƒê·∫°i h·ªçc C√¥ng Th∆∞∆°ng TP.HCM (HUIT)</b>.<br>
            B·∫°n c·∫ßn h·ªèi g√¨ kh√¥ng?
        </div>
    `;
};

/* ===== G·ª¨I TIN NH·∫ÆN ===== */
function send(text = null) {
    const input = document.getElementById("message");
    const msg = text ?? input.value.trim();
    if (!msg) return;

    const box = document.getElementById("chatbox");

    // user message
    box.innerHTML += `<div class="message user">${msg}</div>`;
    box.scrollTop = box.scrollHeight;
    input.value = "";

    fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: msg })
    })
    .then(res => res.json())
    .then(data => {
        box.innerHTML += `<div class="message bot">${data.reply}</div>`;
        box.scrollTop = box.scrollHeight;
    })
    .catch(() => {
        box.innerHTML += `<div class="message bot">L·ªói k·∫øt n·ªëi server.</div>`;
    });
}

/* ===== ENTER ƒê·ªÇ G·ª¨I ===== */
document.getElementById("message").addEventListener("keydown", e => {
    if (e.key === "Enter") {
        e.preventDefault();
        send();
    }
});

/* ===== VOICE INPUT ===== */
const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;

if (SpeechRecognition) {
    const recognition = new SpeechRecognition();
    recognition.lang = "vi-VN";

    function startVoice() {
        recognition.start();
    }

    recognition.onresult = e => {
        send(e.results[0][0].transcript);
    };

    window.startVoice = startVoice;
} else {
    function startVoice() {
        alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ gi·ªçng n√≥i");
    }
}
</script>

</body>
</html>
